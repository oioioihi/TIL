## 프로세스 간 통신

- 프로세스는 독립적으로 실행되기도 하지만 다른 프로세스와 데이터를 주고 받으며 통신을 하는 경우도 있습니다.

1.첫번째는 한 컴퓨터 내에서 프로세스 간 통신을 하는 방법으로 파일과 파이프롤 이용하는 방법이다.

- 파일 : 통신을 하려는 프로세스들이 하나의 파일을 이용해 읽고 쓰는 방법이다.
- 파이프 : 운영체제가 생성한 파이프를 이용해 데이터를 읽고 쓰는 방법이다.

<img src="./capture/Screenshot 2024-02-22 at 23.48.14.png" alt="Screenshot 2024-02-22 at 23.48.14" style="zoom: 25%;" /><img src="./capture/Screenshot 2024-02-22 at 23.50.11.png" alt="Screenshot 2024-02-22 at 23.50.11" style="zoom:25%;" />

2.두번째는 한 프로세스 내에서 쓰레드 간 통신을 하는 방법이다.

- 쓰레드는 코드, 데이터, 힙영역을 공유하고 스택만 각자 자기의 것을 가지고 있다.
- 여기서 데이터 영역에 있는 전역변수나 힙을 이용하면 통신이 가능하다.

<img src="./capture/Screenshot 2024-02-22 at 23.52.31.png" alt="Screenshot 2024-02-22 at 23.52.31" style="zoom:25%;" />

3. 세번째 방법은 네트워크를 이용한 방법이다.
   - 운영체제가 제공하는 소켓통신이나 다른 컴퓨터에 있는 함수를 호출하는 RPC를 이용해 통신을 하는 방법이 있다.





## 공유자원과 임계구역(Critical Section)

- 프로세스 간 통신을 할 때 공동으로 이용하는 변수나 파일들이 있는데, 이런 것들을 '공유자원'이라고 한다.
- 문제는, 공유 자원은 여러 프로세스가 공유하고 있기 때문에 각 프로세스의 접근 순서에 따라 결과가 달라질 수 있다.
- 또한 Context Switching으로 시분할 처리를 하기 때문에 어떤 프로세스가 먼저 실행되는지 예측하기 힘들다.
- 따라서, 연산결과를 예측하기 힘들다. =>  '동기화 문제'라고 부른다.
- EX) 게임 속 캐릭터가 공격과 물약아이템 사용을 동시에 했을때, 남은 체력(공유자원)이 얼마가 되는지 => 이때 여러 프로세스가 동시에 사용하면 안되는 영역(공격 받는 코드, 물약 먹는 코드)을 '임계구역'이라고 한다.
- 공유자원을 서로 사용하기 위해 경쟁하는 것을 '경쟁 조건'이라고 한다. => Race Condition 

<img src="./capture/Screenshot 2024-02-23 at 00.12.59.png" alt="Screenshot 2024-02-23 at 00.12.59" style="zoom:25%;" />



~~~java
// 물약을 먹는 코드
int currentHealth = getHealth();
health = currentHealth + 50; // 체력 50 증가

// 공격을 받는 코드
int currentHealth = getHealth();
health = currentHealth - 10; // 체력 10 감소

// health = 공유자원
// 위의 코드 = 임계구역
~~~



## 상호배제 매커니즘 (Mutual Exclusion)

- 임계구역 문제를 해결하기 위해서는 상호배제의 매커니즘이 필요하다.
  1. 주어진 시간에 항상 하나의 프로세스만 임계구역에 접근할수 있어야 한다.
  2. 동시에 여러 요청에서도 하나의 프로세스만 진입하도록 허용한다.
  3. 임계구역에 들어간 프로세스는 최대한 빠르게 나와야한다.



#### Semaphore (세마포어)

- 화장실이 한칸인 카페에서, 화장실을 가기 위해서 대기를 해야한다.
- 화장실 = 공유자원, 화장실 가려고 대기하는 손님 = 프로세스, 열쇠를 주고 돌려받는 직원 = 운영체제, 화장실 대기하는 손님이 기다리는 줄 = 대기 큐 , 화장실 열쇠 = 세파포어 (실제론 정수형 변수)

- 단점 : 세마포어를 획득하고 반환하는 함수를 잘못 사용하면 꼬일 수 있다. => wait() 또는 signal()

 ~~~java
 // 세마포어 선언
 int semaphore = 1;
 
 ---
   
 // 물약을 먹는 코드
   
 wait(s); //열쇠를 요청해서 열쇠를 받고 문을 잠금
 int currentHealth = getHealth();
 health = currentHealth + 50; // 체력 50 증가
 signal(s);
 
 ---
 // 공격을 받는 코드
   
 wait(s); //열쇠를 요청해서 열쇠를 받고 문을 잠금  
 int currentHealth = getHealth();
 health = currentHealth - 10; // 체력 10 감소
 signal(s); // 방에서 나와 직원에게 열쇠 반납
 ~~~



#### Monitor 모니터 

- 세마포어의 단점을 해결한 상호배제 매커니즘
- 따로 운영체제가 처리하는 것이 아니라 프로그래밍 언어 차원에서 지원하는 방법

- ```java
   synchronized
  ```

  

